define(function(require,exports,module){var $=jQuery=require("jquery");var gconfig=require("gconfig");var platform=gconfig.platform;var appUtils=require("appUtils");require("domain");$.extend($.domain,{Service:Service});function Service(){this.reqDic={};this.callBackDic={};}Service.prototype.invoke=function(reqParamVo,callBackFunc){var This=this;var protocol=reqParamVo.getProtocol();var flowNo=reqParamVo.getFlowNo();var url=reqParamVo.getUrl();var param=reqParamVo.getReqParam();var isLastReq=reqParamVo.getIsLastReq();var isAsync=reqParamVo.getIsAsync();var isShowWait=reqParamVo.getIsShowWait();var isShowOverLay=reqParamVo.getIsShowOverLay();var tipsWords=reqParamVo.getTipsWords();var timeOutFunc=reqParamVo.getTimeOutFunc();var dataType=reqParamVo.getDataType();param.clientinfo=appUtils.getSStorageInfo("clientinfo");param.jsessionid=appUtils.getSStorageInfo("jsessionid");if(platform=="0"){param.op_way=param.op_source=0;}else{if(platform=="1"){if(iBrowser.android){param.op_way=param.op_source=3;}else{param.op_way=param.op_source=2;}}else{if(iBrowser.iPhone||iBrowser.iPad){param.op_way=param.op_source=3;}}}This.reqDic[flowNo]=reqParamVo;This.callBackDic[flowNo]=callBackFunc;appUtils.invokeServer(url,param,callBackFunc,isLastReq,isAsync,isShowWait,isShowOverLay,tipsWords,timeOutFunc,dataType);};Service.prototype.onResult=function(flowNo,result){var callBackFunc=this.callBackDic[flowNo];if(callBackFunc!=null){delete this.callBackDic[flowNo];}var reqParamVo=this.reqDic[flowNo];delete this.reqDic[flowNo];var resultVo=new $.domain.ResultVo();resultVo.setErrorNo(result["error_no"]);resultVo.setErrorInfo(result["error_info"]);if($.string.isEmpty(resultVo.getErrorNo())){resultVo.setErrorNo("0");}var dsName=result["dsName"];var resultMap={};if(dsName&&dsName.length>0){for(var i=0;i<dsName.length;i++){var key=dsName[i];resultMap[key]=result[key];}}else{resultMap["results"]=result["results"];dsName=["results"];}resultVo.setDsName(dsName);resultVo.setResults(resultMap);resultVo.setResultHeaders(result["fields"]);resultVo.setReqParamVo(reqParamVo);if(callBackFunc!=null){callBackFunc(resultVo);}};Service.prototype.clearRequest=function(protocol,flowNo){require.async(protocol,function(module){});};Service.prototype.destroy=function(){for(var key in this.callBackDic){delete this.callBackDic[key];}for(var key in this.reqDic){var reqParamVo=this.reqDic[key];var protocol=reqParamVo.getProtocol();this.clearRequest(protocol,key);delete this.reqDic[key];}for(var key in seajs.cache){if(key.indexOf("_async_"+seajs._asyncNum)>-1){delete seajs.cache[key];}}};});